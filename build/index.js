(()=>{"use strict";var s={n:e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return s.d(a,{a}),a},d:(e,a)=>{for(var r in a)s.o(a,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:a[r]})},o:(s,e)=>Object.prototype.hasOwnProperty.call(s,e)};const e=window.wp.element,a=window.wp.components,r=window.wp.apiFetch;var n=s.n(r);const t=new class{constructor(){this.baseUrl="/loginpress-task/v1"}async getSettings(){try{return{success:!0,data:await n()({path:`${this.baseUrl}/settings`,method:"GET"})}}catch(s){return{success:!1,error:s.message}}}async saveSettings(s){try{return{success:!0,data:await n()({path:`${this.baseUrl}/settings`,method:"POST",data:s})}}catch(s){return{success:!1,error:s.message}}}},i=window.ReactJSXRuntime,d=()=>(0,i.jsxs)("div",{className:"lp-task-loading",children:[(0,i.jsx)(a.Spinner,{}),(0,i.jsx)("p",{children:"Loading settings..."})]}),o=({notice:s,onDismiss:e})=>s?(0,i.jsx)(a.Notice,{status:s.type,isDismissible:!0,onRemove:e,children:s.message}):null,l=({settings:s,isDisabled:e,onChange:r})=>(0,i.jsxs)("div",{className:"lp-task-subsection lp-task-history "+(e?"disabled":""),children:[(0,i.jsxs)("h3",{children:[(0,i.jsx)("span",{className:"dashicons dashicons-backup"}),"Task 1: Password History"]}),(0,i.jsx)(a.ToggleControl,{label:"Disallow Last Password",help:"Prevent users from reusing their previous passwords",checked:s.disallow_last_password,onChange:s=>r("disallow_last_password",s),disabled:e}),s.disallow_last_password&&!e&&(0,i.jsx)(a.TextControl,{label:"Number of Previous Passwords to Check",help:"How many previous passwords to remember and check against (1-10)",type:"number",min:"1",max:"10",value:s.password_history_count,onChange:s=>{const e=parseInt(s)||1;r("password_history_count",Math.min(10,Math.max(1,e)))},disabled:e})]}),c=({settings:s,isDisabled:e,onChange:r})=>{const n=s.reminder_days>=s.expiry_days;return(0,i.jsxs)("div",{className:"lp-task-subsection lp-task-reminder "+(e?"disabled":""),children:[(0,i.jsxs)("h3",{children:[(0,i.jsx)("span",{className:"dashicons dashicons-email-alt"}),"Task 2: Password Expiry Reminder"]}),(0,i.jsx)(a.ToggleControl,{label:"Enable Password Expiry Reminder",help:"Send email reminders to users before their password expires",checked:s.enable_reminder,onChange:s=>r("enable_reminder",s),disabled:e}),s.enable_reminder&&!e&&(0,i.jsxs)("div",{className:"lp-task-reminder-fields",children:[(0,i.jsx)(a.TextControl,{label:"Password Expiry (Days)",help:"How many days before a password expires",type:"number",min:"1",max:"365",value:s.expiry_days,onChange:s=>{const e=parseInt(s)||30;r("expiry_days",Math.min(365,Math.max(1,e)))},disabled:e}),(0,i.jsx)(a.TextControl,{label:"Reminder Days Before Expiry",help:`Send reminder this many days before expiry (must be less than ${s.expiry_days})`,type:"number",min:"1",max:s.expiry_days-1,value:s.reminder_days,onChange:e=>{const a=parseInt(e)||7;r("reminder_days",Math.min(s.expiry_days-1,Math.max(1,a)))},disabled:e}),n&&(0,i.jsx)(a.Notice,{status:"warning",isDismissible:!1,children:"Reminder days must be less than expiry days!"})]})]})},p=({settings:s,onSettingChange:e})=>{const r=!s.force_password_reset;return(0,i.jsxs)(a.Card,{children:[(0,i.jsx)(a.CardHeader,{children:(0,i.jsx)("h2",{children:"Password Policy Settings"})}),(0,i.jsxs)(a.CardBody,{children:[(0,i.jsx)("div",{className:"lp-task-setting",children:(0,i.jsx)(a.ToggleControl,{label:"Force Password Reset",help:"Enable password policies for users",checked:s.force_password_reset,onChange:s=>e("force_password_reset",s)})}),(0,i.jsx)(l,{settings:s,isDisabled:r,onChange:e}),(0,i.jsx)(c,{settings:s,isDisabled:r,onChange:e})]})]})},h=()=>{const[s,r]=(0,e.useState)({force_password_reset:!1,disallow_last_password:!1,password_history_count:3,enable_reminder:!1,expiry_days:90,reminder_days:7}),[n,l]=(0,e.useState)(!0),[c,h]=(0,e.useState)(!1),[m,y]=(0,e.useState)(null);(0,e.useEffect)(()=>{x()},[]);const x=async()=>{const s=await t.getSettings();s.success?r(s.data):y({type:"error",message:"Failed to load settings: "+s.error}),l(!1)};return n?(0,i.jsx)(d,{}):(0,i.jsxs)("div",{className:"lp-task-container",children:[(0,i.jsxs)("div",{className:"lp-task-header",children:[(0,i.jsx)("h1",{children:"LoginPress Task Assessment"}),(0,i.jsx)("p",{children:"Configure password policies and expiry reminders"})]}),(0,i.jsx)(o,{notice:m,onDismiss:()=>y(null)}),(0,i.jsx)(p,{settings:s,onSettingChange:(s,e)=>{r(a=>({...a,[s]:e}))}}),(0,i.jsx)("div",{className:"lp-task-actions",children:(0,i.jsx)(a.Button,{variant:"primary",onClick:async()=>{h(!0),y(null);const e=await t.saveSettings(s);e.success?y({type:"success",message:e.data.message||"Settings saved successfully!"}):y({type:"error",message:"Failed to save settings: "+e.error}),h(!1)},isBusy:c,disabled:c||s.reminder_days>=s.expiry_days,children:c?"Saving...":"Save Settings"})})]})},m=document.getElementById("loginpress-task-root");m&&(0,e.render)((0,i.jsx)(h,{}),m)})();